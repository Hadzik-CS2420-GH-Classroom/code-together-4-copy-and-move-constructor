name: Sync README to Public Repo

# Trigger when README changes on main branch
on:
  push:
    branches: [main]
    paths:
      - 'README.md'

  # Allow manual trigger
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    # Only run on the original repo, not student forks
    if: github.repository == 'Hadzik-CS2420-GH-Classroom/code-together-4-copy-and-move-constructor'
    steps:
      - name: Trigger sync in course_code_together
        env:
          PAT_TOKEN: ${{ secrets.PAT_TOKEN }}
        run: |
          curl -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer $PAT_TOKEN" \
            https://api.github.com/repos/Hadzik-CS2420-GH-Classroom/course_code_together/dispatches \
            -d '{"event_type":"sync-readme","client_payload":{"source_repo":"${{ github.repository }}","folder_name":"code-together-4-copy-and-move"}}'
